import{r as l,j as r}from"./vendor.1762541069955.BMnP9qq1.js";import{Y as w,A as P,B as _,c as b,aj as U,e as M,T as C,a0 as E,u as j}from"./trading.1762541069955.DOlCN3UG.js";import"./charts.1762541069955.ZSNfHYSo.js";const k="wss://stream.binance.com:9443/ws",A="https://api.binance.com/api/v3",$=d=>{const[v,f]=l.useState(new Map),[x,y]=l.useState(!0),g=l.useCallback(async()=>{try{y(!0);const o=d.map(async i=>{const m=i.replace("/","").toUpperCase(),c=await fetch(`${A}/ticker/24hr?symbol=${m}USDT`);if(!c.ok)return{symbol:i,price:Math.random()*7e4+1e4,change24h:(Math.random()-.5)*10,volume:Math.random()*1e9,high24h:Math.random()*75e3+15e3,low24h:Math.random()*65e3+5e3};const u=await c.json();return{symbol:i,price:parseFloat(u.lastPrice),change24h:parseFloat(u.priceChangePercent),volume:parseFloat(u.volume),high24h:parseFloat(u.highPrice),low24h:parseFloat(u.lowPrice)}}),h=await Promise.all(o),a=new Map(h.map(i=>[i.symbol,i]));f(a)}catch(o){console.error("Error fetching initial prices:",o);const h=new Map(d.map(a=>[a,{symbol:a,price:Math.random()*7e4+1e4,change24h:(Math.random()-.5)*10,volume:Math.random()*1e9,high24h:Math.random()*75e3+15e3,low24h:Math.random()*65e3+5e3}]));f(h)}finally{y(!1)}},[d]);l.useEffect(()=>{g();const o=d.map(m=>`${m.replace("/","").toLowerCase()}usdt@ticker`),h=`${k}/${o.join("/")}`;let a;try{a=new WebSocket(h),a.onmessage=m=>{try{const c=JSON.parse(m.data);(Array.isArray(c)?c:[c]).forEach(e=>{if(e.s){const t=e.s.replace("USDT","").toUpperCase();f(s=>{const p=new Map(s);return p.set(t,{symbol:t,price:parseFloat(e.c),change24h:parseFloat(e.P),volume:parseFloat(e.v),high24h:parseFloat(e.h),low24h:parseFloat(e.l)}),p})}})}catch(c){console.error("WebSocket message error:",c)}},a.onerror=()=>{console.error("WebSocket error, using polling fallback")}}catch(m){console.error("WebSocket connection error:",m)}const i=setInterval(()=>{g()},1e4);return()=>{a&&a.close(),clearInterval(i)}},[d,g]);const N=l.useCallback(o=>v.get(o),[v]);return{prices:v,loading:x,getPrice:N}};function B({symbols:d,activeSymbol:v,onSymbolClick:f}){const[x,y]=l.useState([]),[g,N]=l.useState(!1),[o,h]=l.useState(new Set),{prices:a,getPrice:i}=$(d);l.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:{user:e}}=await w.auth.getUser();if(!e)return;const{data:t,error:s}=await w.from("user_watchlist").select("symbol, is_favorite").eq("user_id",e.id);if(s)throw s;const p=new Set((t==null?void 0:t.filter(n=>n.is_favorite).map(n=>n.symbol))||[]);h(p)}catch(e){console.error("Error fetching watchlist:",e)}};l.useEffect(()=>{const e=d.map(t=>{const s=i(t);return{symbol:t,price:(s==null?void 0:s.price)||0,change24h:(s==null?void 0:s.change24h)||0,volume:(s==null?void 0:s.volume)||0,isFavorite:o.has(t)}});y(e)},[d,a,o,i]);const c=async(e,t)=>{t.stopPropagation();try{const{data:{user:s}}=await w.auth.getUser();if(!s){j.error("Please login to add favorites");return}if(o.has(e)){const{error:n}=await w.from("user_watchlist").delete().eq("user_id",s.id).eq("symbol",e);if(n)throw n;h(S=>{const F=new Set(S);return F.delete(e),F}),j.success(`${e} removed from favorites`)}else{const{error:n}=await w.from("user_watchlist").insert({user_id:s.id,symbol:e,is_favorite:!0});if(n)throw n;h(S=>new Set(S).add(e)),j.success(`${e} added to favorites`)}}catch(s){console.error("Error toggling favorite:",s),j.error("Failed to update favorites")}},u=g?x:x.slice(0,6);return r.jsxs("div",{className:"space-y-3 animate-fade-in",children:[r.jsxs("div",{className:"relative overflow-hidden rounded-xl bg-gradient-to-r from-primary/10 via-cyan-500/10 to-primary/10 border border-primary/20 p-3",children:[r.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-5"}),r.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-primary/20 backdrop-blur-sm",children:r.jsx(P,{className:"w-4 h-4 text-primary animate-pulse"})}),r.jsx("h3",{className:"text-sm font-bold tracking-wide text-foreground",children:"Elite Watchlist"})]}),r.jsx(_,{variant:"ghost",size:"sm",className:"h-7 gap-1 text-xs hover:bg-primary/20",onClick:()=>N(!g),children:g?"Show Less":`+${x.length-6}`})]})]}),r.jsx("div",{className:"grid grid-cols-1 gap-2",children:u.map(e=>{const t=e.symbol===v,s=e.change24h>=0;return r.jsxs("div",{onClick:()=>f(e.symbol),className:b("relative overflow-hidden rounded-xl border p-4 transition-all duration-300 cursor-pointer group",t?"bg-gradient-to-r from-primary/20 via-cyan-500/20 to-primary/20 border-primary/50 shadow-xl shadow-primary/30 scale-[1.02]":"border-border/40 bg-card/20 hover:border-primary/40 hover:bg-card/40 hover:scale-[1.01]"),children:[t&&r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 via-transparent to-white/5 animate-shimmer"}),r.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-primary/10 to-transparent rounded-full blur-2xl"}),r.jsxs("div",{className:"relative z-10 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"p-1 rounded bg-primary/10",children:r.jsx("span",{className:"font-mono text-xs font-bold text-foreground",children:e.symbol.toUpperCase()})}),r.jsx(U,{className:b("w-3.5 h-3.5 cursor-pointer transition-all duration-300",e.isFavorite?"fill-yellow-500 text-yellow-500 scale-110":"text-muted-foreground hover:text-yellow-500 hover:scale-110"),onClick:p=>c(e.symbol,p)})]}),r.jsxs(M,{variant:s?"default":"destructive",className:b("text-[10px] font-bold flex items-center gap-1",s?"bg-success/20 text-success border-success/30":"bg-destructive/20 text-destructive border-destructive/30"),children:[s?r.jsx(C,{className:"w-3 h-3"}):r.jsx(E,{className:"w-3 h-3"}),s?"+":"",e.change24h.toFixed(2),"%"]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"flex items-baseline gap-2",children:r.jsxs("span",{className:"text-2xl font-bold text-foreground tracking-tight",children:["$",e.price.toFixed(2)]})}),r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[r.jsx(P,{className:"w-3 h-3"}),"Vol: $",(e.volume/1e6).toFixed(1),"M"]}),e.isFavorite&&r.jsx(M,{variant:"outline",className:"text-[9px] bg-yellow-500/10 text-yellow-500 border-yellow-500/30",children:"Favorite"})]})]}),r.jsx("div",{className:"h-10 opacity-0 group-hover:opacity-100 transition-all duration-300 mt-2",children:r.jsx("div",{className:b("h-full rounded-lg bg-gradient-to-r relative overflow-hidden",s?"from-success/10 via-success/20 to-success/10":"from-destructive/10 via-destructive/20 to-destructive/10"),children:r.jsx("div",{className:"absolute inset-0 flex items-end justify-around p-1",children:[...Array(12)].map((p,n)=>r.jsx("div",{className:b("w-1 rounded-full",s?"bg-success/40":"bg-destructive/40"),style:{height:`${Math.random()*100}%`}},n))})})})]})]},e.symbol)})})]})}export{B as Watchlist};
