import{j as e}from"./vendor-features.1762525081550.Dtz2jQ4N.js";import{r as u}from"./vendor-core.1762525081550.B4_Mh2Lu.js";import{s as h,T as R,B as k,a as A,b as f,d as j,u as C}from"./trading-core.1762525081550.C6kfaM5m.js";import{P as F}from"./trading-advanced-orders.1762525081550.XLpQXhta.js";import{u as E}from"./Index.1762525081550.DrEOfedY.js";import{R as T,W as $,A as D,D as B,T as V,d as W,q as _,N as z,z as O}from"./trading-orders-wrapper.1762525081550.DPz8c97y.js";import"./vendor-ui.1762525081550.OWaSMNrD.js";import"./chart-features.1762525081550.B4YH6Rqt.js";import"./trading-feeds.1762525081550.CAN-kz5W.js";import"./vendor-crypto.1762525081550.DjlH32KV.js";const Z=()=>{const[r,v]=u.useState([]),[L,b]=u.useState(!0),S=r.map(s=>s.symbol),{prices:p,getPrice:N}=E(S),g=async()=>{try{b(!0);const{data:{user:s}}=await h.auth.getUser();if(!s)return;const{data:t,error:i}=await h.from("user_positions").select("*").eq("user_id",s.id).eq("status","open").order("opened_at",{ascending:!1});if(i)throw i;const o=(t||[]).map(a=>({id:a.id,symbol:a.symbol,entry:parseFloat(String(a.entry_price)),current:parseFloat(String(a.current_price||a.entry_price)),quantity:parseFloat(String(a.quantity)),side:a.side,leverage:a.leverage||1,stop_loss:a.stop_loss?parseFloat(String(a.stop_loss)):void 0,take_profit:a.take_profit?parseFloat(String(a.take_profit)):void 0}));v(o)}catch(s){console.error("Error fetching positions:",s),C.error("Failed to load positions")}finally{b(!1)}};u.useEffect(()=>{g();const s=h.channel("position_changes").on("postgres_changes",{event:"*",schema:"public",table:"user_positions"},()=>{g()}).subscribe();return()=>{h.removeChannel(s)}},[]),u.useEffect(()=>{r.length>0&&p.size>0&&v(s=>s.map(t=>{const i=N(t.symbol);return i?{...t,current:i.price}:t}))},[p,N]);const c=s=>s.side==="long"?(s.current-s.entry)*s.quantity:(s.entry-s.current)*s.quantity,d=s=>{const t=c(s),i=s.entry*s.quantity;return!isFinite(i)||i===0?0:t/i*100};if(L)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(T,{className:"w-6 h-6 text-primary animate-spin"})});if(r.length===0)return e.jsxs("div",{className:"text-center p-8 space-y-3",children:[e.jsx($,{className:"w-12 h-12 text-muted-foreground mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"No Open Positions"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Place your first order to start trading"})]})]});const n=r.reduce((s,t)=>s+c(t),0),l=r.reduce((s,t)=>s+t.current*t.quantity,0),y=r.filter(s=>c(s)>0).length/r.length*100,w=n/r.length,x=r.reduce((s,t)=>d(t)>d(s)?t:s,r[0]),m=r.reduce((s,t)=>d(t)<d(s)?t:s,r[0]),q=l!==n?n/(l-n)*100:0;return e.jsxs(R,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-chart-4"}),e.jsx("h3",{className:"text-sm font-semibold text-foreground uppercase tracking-wide",children:"Portfolio Tracker"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:g,children:e.jsx(T,{className:"w-3 h-3"})}),e.jsx(D,{className:"w-4 h-4 text-success animate-pulse"})]})]}),e.jsxs(A,{className:"grid w-full grid-cols-3",children:[e.jsx(f,{value:"overview",children:"Overview"}),e.jsx(f,{value:"positions",children:"Positions"}),e.jsx(f,{value:"analytics",children:"Analytics"})]}),e.jsxs(j,{value:"overview",className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-gradient-to-br from-primary/20 to-transparent border border-primary/30",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(B,{className:"w-3 h-3 text-primary"}),e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase",children:"Total Value"})]}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["$",l.toLocaleString()]}),e.jsxs("div",{className:"text-[10px] text-muted-foreground mt-1",children:[r.length," positions"]})]}),e.jsxs("div",{className:`p-3 rounded-lg border ${n>=0?"bg-success/10 border-success/20":"bg-destructive/10 border-destructive/20"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[n>=0?e.jsx(V,{className:"w-3 h-3 text-success"}):e.jsx(W,{className:"w-3 h-3 text-destructive"}),e.jsx("span",{className:"text-[10px] text-muted-foreground uppercase",children:"Total PnL"})]}),e.jsxs("div",{className:`text-2xl font-bold ${n>=0?"text-success":"text-destructive"}`,children:["$",n.toFixed(2)]}),e.jsxs("div",{className:`text-[10px] mt-1 ${n>=0?"text-success":"text-destructive"}`,children:[q.toFixed(2),"% ROI"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-muted/30 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground mb-1",children:"Win Rate"}),e.jsxs("div",{className:"text-lg font-bold text-primary",children:[y.toFixed(1),"%"]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-muted/30 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground mb-1",children:"Avg PnL"}),e.jsxs("div",{className:`text-lg font-bold ${w>=0?"text-success":"text-destructive"}`,children:["$",w.toFixed(2)]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-muted/30 border border-border",children:[e.jsx("div",{className:"text-[10px] text-muted-foreground mb-1",children:"Best Trade"}),e.jsxs("div",{className:"text-lg font-bold text-success",children:[d(x).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-success/5 border border-success/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Best Performer"]}),e.jsxs("span",{className:"text-sm font-bold text-success",children:["+",d(x).toFixed(2),"%"]})]}),e.jsx("div",{className:"text-sm font-bold text-foreground",children:x.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["$",c(x).toFixed(2)," profit"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-destructive/5 border border-destructive/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Worst Performer"]}),e.jsxs("span",{className:"text-sm font-bold text-destructive",children:[d(m).toFixed(2),"%"]})]}),e.jsx("div",{className:"text-sm font-bold text-foreground",children:m.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["$",c(m).toFixed(2)," loss"]})]})]})]}),e.jsx(j,{value:"positions",className:"space-y-2",children:r.map(s=>{const t=c(s),i=d(s),o=t>=0,a=s.current*s.quantity,P=a/l*100;return e.jsxs("div",{className:"p-3 rounded-lg bg-muted/30 border border-border hover:border-primary/30 transition-all hover:scale-[1.01] group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-foreground",children:s.symbol}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded ${s.side==="long"?"bg-success/20 text-success":"bg-destructive/20 text-destructive"}`,children:s.side.toUpperCase()})]}),e.jsxs("div",{className:`text-sm font-bold ${o?"text-success":"text-destructive"}`,children:[o?"+":"",i.toFixed(2),"%"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Entry"}),e.jsxs("div",{className:"text-foreground font-medium",children:["$",s.entry.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Current"}),e.jsxs("div",{className:"text-foreground font-medium",children:["$",s.current.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"PnL"}),e.jsxs("div",{className:`font-bold ${o?"text-success":"text-destructive"}`,children:["$",t.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"text-muted-foreground",children:"Portfolio Allocation"}),e.jsxs("span",{className:"text-foreground font-medium",children:[P.toFixed(1),"%"]})]}),e.jsx(F,{value:P,className:"h-1"})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50 text-[10px] text-muted-foreground",children:["Qty: ",s.quantity," | Value: $",a.toLocaleString()]})]},s.id)})}),e.jsxs(j,{value:"analytics",className:"space-y-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-muted/30 to-transparent border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(z,{className:"w-4 h-4 text-primary"}),e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Asset Allocation"})]}),e.jsx("div",{className:"space-y-2",children:r.map(s=>{const i=s.current*s.quantity/l*100;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-foreground font-medium",children:s.symbol}),e.jsxs("span",{className:"text-muted-foreground",children:[i.toFixed(1),"%"]})]}),e.jsx(F,{value:i,className:"h-2"})]},s.id)})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-primary/10 to-chart-4/10 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(O,{className:"w-4 h-4 text-primary"}),e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:"Risk Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground mb-1",children:"Diversification"}),e.jsxs("div",{className:"text-lg font-bold text-primary",children:[r.length," assets"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground mb-1",children:"Max Drawdown"}),e.jsxs("div",{className:"text-lg font-bold text-destructive",children:[d(m).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground mb-1",children:"Sharpe Ratio"}),e.jsx("div",{className:"text-lg font-bold text-chart-2",children:(y/100*2.5).toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground mb-1",children:"Total Exposure"}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:["$",l.toLocaleString()]})]})]})]})]})]})};export{Z as PortfolioTracker};
