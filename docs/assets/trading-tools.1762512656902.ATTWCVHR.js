import{r as p}from"./vendor-core.1762512656902.BARHdY6Y.js";import"./vendor-features.1762512656902.DE-n-Sfo.js";import"./trading-core.1762512656902.CD1KokD7.js";const A=(w=["BTCUSDT","ETHUSDT","SOLUSDT","ADAUSDT"],c="crypto",h)=>{var U;const[y,d]=p.useState({}),[P,f]=p.useState(!0),[E,m]=p.useState(null),n=p.useRef(null),g=p.useRef(null),b=r=>r.replace("USDT","/USDT").replace("BUSD","/BUSD"),D=()=>{try{n.current&&n.current.close();const k=(()=>{switch(c){case"crypto":return`wss://stream.binance.com:9443/ws/${w.map(t=>`${t.toLowerCase()}@ticker`).join("/")}`;case"forex":return`wss://stream.oanda.com/v3/instruments/${w.join(",")}/price`;case"stocks":case"indices":return"wss://ws.finnhub.io?token=your_finnhub_api_key";default:return null}})();if(!k)throw new Error(`WebSocket not supported for market type: ${c}`);n.current=new WebSocket(k),n.current.onopen=()=>{console.log("WebSocket connected for market data"),m(null),f(!1)},n.current.onmessage=i=>{try{const t=JSON.parse(i.data);switch(c){case"crypto":if(t.data&&t.data.s){const a=t.data.s,e=parseFloat(t.data.c),o=parseFloat(t.data.P),s=t.data.v,l=parseFloat(t.data.h),u=parseFloat(t.data.l);d(F=>({...F,[a]:{symbol:b(a),price:e,change:e*o/100,changePercent:o,volume:S(parseFloat(s)),high24h:l,low24h:u,lastUpdate:Date.now(),marketType:c,exchange:h}}))}break;case"forex":if(t.type==="PRICE"){const a=t.instrument,e=parseFloat(t.bids[0].price),o=t.closeoutBid,s=e-o,l=s/o*100;d(u=>({...u,[a]:{symbol:b(a),price:e,change:s,changePercent:l,volume:"N/A",high24h:e,low24h:e,lastUpdate:Date.now(),marketType:c,exchange:h}}))}break;case"stocks":case"indices":if(t.type==="trade"){const a=t.data[0].s,e=parseFloat(t.data[0].p),o=e-parseFloat(t.data[0].c),s=e-o,l=s/o*100,u=t.data[0].v;d(F=>({...F,[a]:{symbol:b(a),price:e,change:s,changePercent:l,volume:S(parseFloat(u)),high24h:e,low24h:e,lastUpdate:Date.now(),marketType:c,exchange:h}}))}break}}catch(t){console.error("Error parsing WebSocket message:",t)}},n.current.onerror=i=>{console.error("WebSocket error:",i),m("WebSocket connection error")},n.current.onclose=i=>{console.log("WebSocket closed:",i.code,i.reason),i.code!==1e3&&(g.current=setTimeout(()=>{console.log("Attempting to reconnect WebSocket..."),D()},5e3))}}catch(r){console.error("Error connecting WebSocket:",r),m("Failed to connect to market data"),f(!1)}},S=r=>r>=1e9?`${(r/1e9).toFixed(1)}B`:r>=1e6?`${(r/1e6).toFixed(1)}M`:r>=1e3?`${(r/1e3).toFixed(1)}K`:r.toFixed(2),$=async()=>{try{f(!0);const r=()=>{switch(c){case"crypto":return"https://api.binance.com/api/v3/ticker/24hr";case"forex":return"https://api.oanda.com/v3/instruments";case"stocks":return"https://finnhub.io/api/v1/quote";case"indices":return"https://finnhub.io/api/v1/quote";default:return"https://api.binance.com/api/v3/ticker/24hr"}},k=()=>{const e={"Content-Type":"application/json"};switch(c){case"forex":e.Authorization="Bearer your_oanda_api_key";break;case"stocks":case"indices":e["X-Finnhub-Token"]="your_finnhub_api_key";break}return e},i=w.map(async e=>{const o=r(),s=k();let l=o;switch(c){case"crypto":l=`${o}?symbol=${e}`;break;case"forex":l=`${o}/${e}/candles/latest`;break;case"stocks":case"indices":l=`${o}?symbol=${e}`;break}const u=await fetch(l,{headers:s});if(!u.ok)throw new Error(`Failed to fetch ${e}`);return u.json()}),t=await Promise.all(i),a={};t.forEach(e=>{const o=parseFloat(e.lastPrice),s=parseFloat(e.priceChangePercent);a[e.symbol]={symbol:b(e.symbol),price:o,change:parseFloat(e.priceChange),changePercent:s,volume:S(parseFloat(e.volume)),high24h:parseFloat(e.highPrice),low24h:parseFloat(e.lowPrice),lastUpdate:Date.now(),marketType:c,exchange:h}}),d(a)}catch(r){console.error("Error fetching initial market data:",r),m("Failed to fetch initial market data")}finally{f(!1)}};return p.useEffect(()=>($(),D(),()=>{n.current&&n.current.close(1e3,"Component unmounting"),g.current&&clearTimeout(g.current)}),[]),{marketData:Object.values(y),marketDataMap:y,loading:P,error:E,refetch:$,isConnected:((U=n.current)==null?void 0:U.readyState)===WebSocket.OPEN}};export{A as u};
